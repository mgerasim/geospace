@model GeospaceMediana.Models.ViewDisturbanceList
@{
    ViewBag.Title = "Нарушение радиосвязи";
}
<script>
    var submitUrl = "@Url.Action("Submit", "Disturbance")";
    var deleteUrl = "@Url.Action("Delete", "Disturbance")";
    var currentYear = "@ViewBag.YYYY";
    var currentMonth = "@ViewBag.MM.ToString("D2")";
</script>
<style type="text/css">
    .col-md-3:hover {
        background-color:RGB(238,238,238);
        cursor: pointer;
    }
    #startTimePeriod, #durationTimePeriod {
        width: 100%;
        height: 40px;
        font-size: 16px;
        font-weight: 600;
    }
</style>
<script type="text/javascript">
    function handleSaveTime(station, day, Name ) {
        $("#stationNum").val(station);
        $("#dayInMonths").val(day);
        $("#startTimePeriod").val(0);
        $("#durationTimePeriod").val(1);
        $(".modal-title").html("Нарушение радиосвязи на ст. " + Name + " за " + day + "." + currentMonth + "." + currentYear);
    }
    function Submit() {
        var resUrl = window.submitUrl +
                        "?station=" + $("#stationNum").val() +
                        "&year=" + window.currentYear +
                        "&month=" + window.currentMonth +
                        "&day=" + $("#dayInMonths").val() +
                        "&hour=" + $("#startTimePeriod").val() +
                        "&duration=" + $("#durationTimePeriod").val();
        $.ajax({
            url: resUrl,
            success: function () { location.reload(); }
        });
    }

        
        function Delete() {
            var resUrl = window.deleteUrl +
                            "?station=" + $("#stationNum").val() +
                            "&year=" + window.currentYear +
                            "&month=" + window.currentMonth +
                            "&day=" + $("#dayInMonths").val() +
                            "&hour=" + $("#startTimePeriod").val() +
                            "&duration=" + $("#durationTimePeriod").val();
            console.log(resUrl);
            $.ajax({
                url: resUrl,
                success: function () { location.reload(); }
            });
    }
</script>
<table class="table table-bordered table-striped table-disturbance">
    <thead>
        <tr>
            <th colspan="@(Model.theStationList.Count + 1)">
                @Model.Title
            </th>
        </tr>
        <tr>
            <th rowspan="2">День</th>
            <th colspan="@Model.theStationList.Count">Станция</th>

        </tr>

        <tr>
            @foreach (var item in Model.theStationList)
            {
                <th>@item.Name</th>
            }
        </tr>
    </thead>
    <tbody>
        @for (int i = 1; i <= DateTime.DaysInMonth(ViewBag.YYYY, ViewBag.MM); i++)
{

    <tr>
        <td>@i</td>
        @foreach (var item in Model.theStationList)
{
    <td id="@item.Code@i" data-whatever="@item.Code@i" data-toggle="modal" data-target="#myModal" class="col-md-3" onclick="handleSaveTime('@item.Code','@i.ToString("D2")', '@item.Name' )">@Html.Raw(Model.Display(item.Code, ViewBag.YYYY, ViewBag.MM, i))</td>
}
    </tr>
}
    </tbody>
</table>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModelLable">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabele"></h4>
            </div>
            <a id="stationNum"></a>
            <a id="dayInMonths"></a>
            <div class="modal-body">
                <div id="cloudiness-panel1" class="panel panel-success">
                    <div id="cloudiness-panel-heading" class="panel-heading ms">Начало</div>
                    <div class="panel-body">
                        <select id="startTimePeriod" class="btn dropdown-toggle btn-default">
                            @for (int i = 0; i < 24; i++)
                            {
                                <option value="@i">@i.ToString("D2") час</option>
                            }
                        </select>
                    </div>
                </div>
                <div id="cloudiness-panel2" class="panel panel-success">
                    <div id="cloudiness-panel2-heading" class="panel-heading ms">Продолжительность (в часах)</div>
                    <div class="panel-body">
                        <select id="durationTimePeriod" class="btn dropdown-toggle btn-default">
                            @for (int i = 1; i <= 24; i++)
                            {
                                <option value="@i">@i.ToString("D2")</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="Submit()" class="btn btn-primary">Добавить</button>
                <button type="button" onclick="Delete()" class="btn btn-danger">Удалить</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Отмена</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

